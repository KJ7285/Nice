local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Mc4121ban/Linoria-Library-Mobile/refs/heads/main/Gui%20Lib%20%5BLibrary%5D"))()
local ThemeManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/KJ7285/Theme-manger-/refs/heads/main/ThemeManager.Lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/Mc4121ban/Linoria-Library-Mobile/refs/heads/main/Gui%20Lib%20%5BSaveManager%5D"))()
local Window = Library:CreateWindow({Title='Example menu',Center=true,AutoShow=true,TabPadding=8,MenuFadeTime=0.2,Size=UDim2.new(0,450,0,450)})
local Tabs = {Main = Window:AddTab('Main'), ['UI Settings'] = Window:AddTab('UI Settings')}

local predX = 0.13946352838245239252
local predY = 0.075
local camlockEnabled = false
local targetPlayer = nil
local targetUserId = nil
local waitingForRejoin = false
local connRender = nil
local currentHighlight = nil
local wallCheckEnabled = false
local friendCheckEnabled = false
local koCheckEnabled = false
local autoAirEnabled = false
local prevInAir = false

local mainGroup = Tabs.Main:AddLeftGroupbox('CamLock Settings')
local camlockToggle = mainGroup:AddToggle('CamLock',{Text='Enable CamLock',Default=false,Tooltip='Enable/disable camlock',Callback=function(val)
    camlockEnabled=val
    if not camlockEnabled then
        if connRender then connRender:Disconnect() connRender=nil end
        if currentHighlight then currentHighlight:Destroy() currentHighlight=nil end
        targetPlayer=nil targetUserId=nil waitingForRejoin=false prevInAir=false
        btn.Text="🔓"
        Library:Notify("Tanku: CamLock disabled, stopped any lock")
    end
end})
local predXInput = mainGroup:AddInput('PredX',{Default=tostring(predX),Numeric=true,Finished=false,Text='Prediction X',Tooltip='Horizontal prediction multiplier',Placeholder='e.g. 0.139',Callback=function(val)
    local num=tonumber(val)
    if num then predX=num end
end})
local predYInput = mainGroup:AddInput('PredY',{Default=tostring(predY),Numeric=true,Finished=false,Text='Prediction Y',Tooltip='Vertical prediction multiplier',Placeholder='e.g. 0.075',Callback=function(val)
    local num=tonumber(val)
    if num then predY=num end
end})
-- Full R15 parts list for dropdowns:
local r15Parts = {
    "HumanoidRootPart",
    "LowerTorso",
    "UpperTorso",
    "Head",
    "LeftUpperArm",
    "LeftLowerArm",
    "LeftHand",
    "RightUpperArm",
    "RightLowerArm",
    "RightHand",
    "LeftUpperLeg",
    "LeftLowerLeg",
    "LeftFoot",
    "RightUpperLeg",
    "RightLowerLeg",
    "RightFoot"
}
local aimDropdown = mainGroup:AddDropdown('AimPartDropdown',{Values=r15Parts,Default=1,Multi=false,Text='AimPart',Tooltip='Part to aim when on ground',Callback=function(val) end})
local airDropdown = mainGroup:AddDropdown('AirPartDropdown',{Values=r15Parts,Default=1,Multi=false,Text='AirPart',Tooltip='Part to aim when in air',Callback=function(val) end})
mainGroup:AddLabel('Highlight Color'):AddColorPicker('HighlightColor',{Default=Color3.new(1,0,0),Title='Highlight Color',Transparency=0,Callback=function(val) end})
local wallToggle = mainGroup:AddToggle('WallCheck',{Text='WallCheck',Default=false,Tooltip='Skip targets blocked by walls on acquire',Callback=function(val) wallCheckEnabled=val end})
local friendToggle = mainGroup:AddToggle('FriendCheck',{Text='FriendCheck',Default=false,Tooltip='Skip locking friends',Callback=function(val) friendCheckEnabled=val end})
local koToggle = mainGroup:AddToggle('KoCheck',{Text='KoCheck',Default=false,Tooltip='Unlock if target Knocked attribute true',Callback=function(val) koCheckEnabled=val end})
local autoAirToggle = mainGroup:AddToggle('AutoAir',{Text='AutoAir',Default=false,Tooltip='Activate tool when target goes into air',Callback=function(val) autoAirEnabled=val end})

ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()
ThemeManager:SetFolder('MyScriptHub')
SaveManager:SetFolder('MyScriptHub/specific-game')
SaveManager:BuildConfigSection(Tabs['UI Settings'])
ThemeManager:ApplyToTab(Tabs['UI Settings'])
SaveManager:LoadAutoloadConfig()

local Players=game:GetService("Players")
local LocalPlayer=Players.LocalPlayer
local RunService=game:GetService("RunService")
local UserInputService=game:GetService("UserInputService")
local cam=workspace.CurrentCamera

local screenGui=Instance.new("ScreenGui")
screenGui.Name="CamLockGui"
screenGui.ResetOnSpawn=false
screenGui.Parent=game:GetService("CoreGui")

local btn=Instance.new("TextButton")
btn.Size=UDim2.new(0,60,0,60)
btn.Position=UDim2.new(0,10,0,100)
btn.AnchorPoint=Vector2.new(0,0)
btn.BackgroundTransparency=0
btn.BackgroundColor3=Color3.new(0,0,0)
btn.BorderSizePixel=0
btn.Text="🔓"
btn.TextScaled=true
btn.Parent=screenGui

local uiCorner=Instance.new("UICorner")
uiCorner.CornerRadius=UDim.new(0,0.4)
uiCorner.Parent=btn

local function destroyHighlight()
    if currentHighlight then currentHighlight:Destroy() currentHighlight=nil end
end
local function applyHighlight(char)
    destroyHighlight()
    local h=Instance.new("Highlight")
    h.Adornee=char
    h.FillTransparency=0.5
    h.OutlineTransparency=0
    h.OutlineColor=Options.HighlightColor.Value or Color3.new(1,0,0)
    h.Parent=char
    currentHighlight=h
end
local function raycastBlock(origin,pos)
    local params=RaycastParams.new()
    params.FilterType=Enum.RaycastFilterType.Blacklist
    local ignoreList={LocalPlayer.Character}
    if targetPlayer and targetPlayer.Character then table.insert(ignoreList,targetPlayer.Character) end
    params.FilterDescendantsInstances=ignoreList
    local result=workspace:Raycast(origin,pos-origin,params)
    if result then
        return true
    end
    return false
end
local function stopLock()
    if connRender then connRender:Disconnect() connRender=nil end
    destroyHighlight()
    targetPlayer=nil
    targetUserId=nil
    waitingForRejoin=false
    prevInAir=false
    btn.Text="🔓"
    Library:Notify("Tanku:Unlocked from them")
end
local function startRenderSteppedLock(pl)
    if connRender then connRender:Disconnect() connRender=nil end
    connRender=RunService.RenderStepped:Connect(function()
        if not camlockEnabled then stopLock() return end
        if not targetPlayer then stopLock() return end
        local char=targetPlayer.Character
        if not char then waitingForRejoin=true return end
        local humanoid=char:FindFirstChild("Humanoid")
        if not humanoid or humanoid.Health<=0 then waitingForRejoin=true return end
        if koCheckEnabled then
            local knocked=char:GetAttribute("Knocked")
            if knocked then stopLock() return end
        end
        local floorMat=humanoid.FloorMaterial or Enum.Material.Air
        local inAir = (floorMat==Enum.Material.Air)
        if inAir then
            if autoAirEnabled and not prevInAir then
                prevInAir=true
                task.delay(0.2, function()
                    if targetPlayer and targetPlayer.Character then
                        local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
                        if tool and tool.Parent==LocalPlayer.Character then
                            tool:Activate()
                        end
                    end
                end)
            end
        else
            prevInAir=false
        end
        local partName = inAir and Options.AirPartDropdown.Value or Options.AimPartDropdown.Value
        local rootPart=char:FindFirstChild(partName)
        if not rootPart then waitingForRejoin=true return end
        waitingForRejoin=false
        applyHighlight(char)
        local vel=rootPart.Velocity
        local fallOffset=0
        if vel.Y<0 then fallOffset=-0.27 end
        local offset=Vector3.new(vel.X*predX,vel.Y*predY+fallOffset,vel.Z*predX)
        local aimPos=rootPart.Position+offset
        local camPos=cam.CFrame.Position
        cam.CFrame=CFrame.new(camPos,aimPos)
    end)
end
local function attemptLockOn(pl)
    if not camlockEnabled then Library:Notify("Enable CamLock toggle first 😏") return end
    if friendCheckEnabled and LocalPlayer:IsFriendsWith(pl.UserId) then Library:Notify("Skipping friend "..pl.Name) return end
    if wallCheckEnabled then
        local root=pl.Character and pl.Character:FindFirstChild(Options.AimPartDropdown.Value)
        if root then
            local blocked=raycastBlock(cam.CFrame.Position, root.Position)
            if blocked then Library:Notify("Wall blocks "..pl.Name..", skipping") return end
        end
    end
    targetPlayer=pl
    targetUserId=pl.UserId
    prevInAir=false
    btn.Text="🔒"
    Library:Notify("Tanku:Locked in "..pl.Name)
    waitingForRejoin=false
    startRenderSteppedLock(pl)
end

local dragging=false
local dragInput,dragStart,startPos
btn.InputBegan:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then
        dragging=true
        dragStart=input.Position
        startPos=btn.Position
        input.Changed:Connect(function()
            if input.UserInputState==Enum.UserInputState.End then dragging=false end
        end)
    end
end)
btn.InputChanged:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseMovement then
        dragInput=input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input==dragInput and dragging then
        local delta=input.Position-dragStart
        btn.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
    end
end)

btn.MouseButton1Click:Connect(function()
    if targetPlayer then
        local char=targetPlayer.Character
        local humanoid=char and char:FindFirstChild("Humanoid")
        if char and humanoid and humanoid.Health>0 then stopLock() return end
    end
    local closest,minDist=nil,math.huge
    for _,pl in pairs(Players:GetPlayers()) do
        if pl~=LocalPlayer and pl.Character and pl.Character:FindFirstChild("HumanoidRootPart") and pl.Character:FindFirstChild("Humanoid") and pl.Character.Humanoid.Health>0 then
            if friendCheckEnabled and LocalPlayer:IsFriendsWith(pl.UserId) then continue end
            local root=pl.Character:FindFirstChild(Options.AimPartDropdown.Value) or pl.Character:FindFirstChild("HumanoidRootPart")
            if not root then continue end
            local screenPos,vis=cam:WorldToViewportPoint(root.Position)
            if vis then
                local dx=screenPos.X-cam.ViewportSize.X/2
                local dy=screenPos.Y-cam.ViewportSize.Y/2
                local dist=math.sqrt(dx*dx+dy*dy)
                if dist<minDist then minDist=dist closest=pl end
            end
        end
    end
    if closest then attemptLockOn(closest) else Library:Notify("No valid target found 🤷‍♂️") end
end)

Players.PlayerRemoving:Connect(function(pl)
    if targetPlayer and pl==targetPlayer then waitingForRejoin=true end
end)
Players.PlayerAdded:Connect(function(pl)
    if waitingForRejoin and targetUserId==pl.UserId then
        pl.CharacterAdded:Connect(function(char)
            if camlockEnabled and targetUserId==pl.UserId then
                task.wait(0.5)
                if pl.Character and pl.Character:FindFirstChild("HumanoidRootPart") then
                    targetPlayer=pl
                    startRenderSteppedLock(pl)
                    Library:Notify("Tanku:Re-locked "..pl.Name)
                end
            end
        end)
    end
end)
Players.LocalPlayer.CharacterAdded:Connect(function() end)
